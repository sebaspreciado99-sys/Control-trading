<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    
    <!-- CONFIGURACI√ìN PWA - ESENCIAL -->
    <meta name="theme-color" content="#000000">
    <link rel="manifest" href="manifest.json">
    
    <!-- Configuraci√≥n para iOS/Safari -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Control Trading">
    <link rel="apple-touch-icon" href="icon-192.png">
    
    <title>Control Trading PWA</title>
    
    <!-- ESTILOS CSS -->
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        :root {
            --primary: #2563eb;
            --primary-dark: #1d4ed8;
            --success: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
            --dark: #1f2937;
            --light: #f9fafb;
            --gray: #6b7280;
            --border: #e5e7eb;
        }
        
        body {
            background-color: var(--light);
            color: var(--dark);
            line-height: 1.6;
            padding: 0;
            margin: 0;
            min-height: 100vh;
        }
        
        /* HEADER Y NAVEGACI√ìN */
        .app-header {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            padding: 1rem;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .app-title {
            font-size: 1.5rem;
            font-weight: 600;
        }
        
        .install-btn {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s;
            display: none;
        }
        
        .install-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }
        
        /* CONTENEDOR PRINCIPAL */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 1rem;
        }
        
        /* ESTAD√çSTICAS */
        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }
        
        .stat-card {
            background: white;
            border-radius: 10px;
            padding: 1.5rem;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
            text-align: center;
        }
        
        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }
        
        .profit { color: var(--success); }
        .loss { color: var(--danger); }
        .neutral { color: var(--gray); }
        
        /* FORMULARIO */
        .form-container {
            background: white;
            border-radius: 10px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }
        
        .form-title {
            font-size: 1.3rem;
            margin-bottom: 1.5rem;
            color: var(--dark);
            border-bottom: 2px solid var(--border);
            padding-bottom: 0.5rem;
        }
        
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
        }
        
        .form-group {
            margin-bottom: 1rem;
        }
        
        label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: var(--dark);
        }
        
        input, select {
            width: 100%;
            padding: 0.8rem;
            border: 1px solid var(--border);
            border-radius: 6px;
            font-size: 1rem;
            transition: border 0.3s;
        }
        
        input:focus, select:focus {
            outline: none;
            border-color: var(--primary);
        }
        
        .btn-group {
            display: flex;
            gap: 1rem;
            margin-top: 1.5rem;
        }
        
        .btn {
            padding: 0.8rem 1.5rem;
            border: none;
            border-radius: 6px;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            flex: 1;
        }
        
        .btn-primary {
            background-color: var(--primary);
            color: white;
        }
        
        .btn-primary:hover {
            background-color: var(--primary-dark);
        }
        
        .btn-secondary {
            background-color: #e5e7eb;
            color: var(--dark);
        }
        
        .btn-secondary:hover {
            background-color: #d1d5db;
        }
        
        /* TABLA DE OPERACIONES */
        .table-container {
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            margin-bottom: 2rem;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        thead {
            background-color: var(--primary);
            color: white;
        }
        
        th {
            padding: 1rem;
            text-align: left;
            font-weight: 600;
        }
        
        tbody tr {
            border-bottom: 1px solid var(--border);
            transition: background-color 0.2s;
        }
        
        tbody tr:hover {
            background-color: #f9fafb;
        }
        
        td {
            padding: 1rem;
        }
        
        .status-badge {
            padding: 0.3rem 0.8rem;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 500;
        }
        
        .status-open { background-color: #dbeafe; color: var(--primary); }
        .status-closed { background-color: #dcfce7; color: var(--success); }
        .status-loss { background-color: #fee2e2; color: var(--danger); }
        
        .action-btn {
            padding: 0.4rem 0.8rem;
            border: none;
            border-radius: 4px;
            font-size: 0.85rem;
            cursor: pointer;
            margin-right: 0.5rem;
        }
        
        .btn-close { background-color: var(--success); color: white; }
        .btn-edit { background-color: var(--warning); color: white; }
        .btn-delete { background-color: var(--danger); color: white; }
        
        /* FOOTER */
        .app-footer {
            text-align: center;
            padding: 1.5rem;
            color: var(--gray);
            font-size: 0.9rem;
            border-top: 1px solid var(--border);
            background: white;
        }
        
        /* MENSAJES */
        .message {
            padding: 1rem;
            border-radius: 6px;
            margin-bottom: 1rem;
            display: none;
        }
        
        .message.success {
            background-color: #dcfce7;
            color: var(--success);
            border: 1px solid #bbf7d0;
            display: block;
        }
        
        .message.error {
            background-color: #fee2e2;
            color: var(--danger);
            border: 1px solid #fecaca;
            display: block;
        }
        
        /* RESPONSIVE */
        @media (max-width: 768px) {
            .stats-container {
                grid-template-columns: 1fr 1fr;
            }
            
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .btn-group {
                flex-direction: column;
            }
            
            table {
                display: block;
                overflow-x: auto;
            }
        }
        
        @media (max-width: 480px) {
            .stats-container {
                grid-template-columns: 1fr;
            }
            
            .header-content {
                flex-direction: column;
                gap: 1rem;
            }
            
            .app-title {
                font-size: 1.2rem;
            }
        }
        
        /* OFFLINE INDICATOR */
        .offline-indicator {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: var(--danger);
            color: white;
            padding: 0.8rem 1.5rem;
            border-radius: 30px;
            box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3);
            display: none;
            z-index: 1000;
            animation: fadeIn 0.3s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body>
    <!-- HEADER DE LA APLICACI√ìN -->
    <header class="app-header">
        <div class="header-content">
            <h1 class="app-title">üìà Control Trading PWA</h1>
            <button id="installButton" class="install-btn">‚¨áÔ∏è Instalar App</button>
        </div>
    </header>
    
    <!-- INDICADOR DE CONEXI√ìN -->
    <div id="offlineIndicator" class="offline-indicator">
        ‚ö†Ô∏è Sin conexi√≥n - Modo offline activado
    </div>
    
    <!-- CONTENEDOR PRINCIPAL -->
    <main class="container">
        <!-- MENSAJES -->
        <div id="messageContainer"></div>
        
        <!-- ESTAD√çSTICAS -->
        <section class="stats-container">
            <div class="stat-card">
                <div class="stat-value profit" id="totalProfit">$0.00</div>
                <div>Ganancia Total</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="totalTrades">0</div>
                <div>Operaciones Totales</div>
            </div>
            <div class="stat-card">
                <div class="stat-value success" id="winRate">0%</div>
                <div>Tasa de Acierto</div>
            </div>
            <div class="stat-card">
                <div class="stat-value neutral" id="openTrades">0</div>
                <div>Operaciones Abiertas</div>
            </div>
        </section>
        
        <!-- FORMULARIO DE OPERACIONES -->
        <section class="form-container">
            <h2 class="form-title" id="formTitle">üìù Nueva Operaci√≥n</h2>
            <form id="tradeForm">
                <input type="hidden" id="tradeId">
                
                <div class="form-grid">
                    <div class="form-group">
                        <label for="asset">Activo/Par</label>
                        <input type="text" id="asset" placeholder="Ej: BTC/USD, AAPL" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="type">Tipo de Operaci√≥n</label>
                        <select id="type" required>
                            <option value="">Seleccionar</option>
                            <option value="buy">Compra (Long)</option>
                            <option value="sell">Venta (Short)</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="entryPrice">Precio de Entrada</label>
                        <input type="number" id="entryPrice" step="0.000001" placeholder="0.00" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="exitPrice">Precio de Salida</label>
                        <input type="number" id="exitPrice" step="0.000001" placeholder="0.00">
                    </div>
                    
                    <div class="form-group">
                        <label for="quantity">Cantidad</label>
                        <input type="number" id="quantity" step="0.000001" placeholder="0.00" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="status">Estado</label>
                        <select id="status" required>
                            <option value="open">Abierta</option>
                            <option value="closed">Cerrada</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="date">Fecha</label>
                        <input type="datetime-local" id="date" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="notes">Notas</label>
                        <input type="text" id="notes" placeholder="Observaciones de la operaci√≥n">
                    </div>
                </div>
                
                <div class="btn-group">
                    <button type="submit" class="btn btn-primary" id="submitBtn">üíæ Guardar Operaci√≥n</button>
                    <button type="button" class="btn btn-secondary" id="clearBtn">üîÑ Limpiar Formulario</button>
                </div>
            </form>
        </section>
        
        <!-- TABLA DE OPERACIONES -->
        <section class="table-container">
            <h2 style="padding: 1rem; margin: 0; border-bottom: 1px solid var(--border);">
                üìä Historial de Operaciones
            </h2>
            <div style="overflow-x: auto;">
                <table id="tradesTable">
                    <thead>
                        <tr>
                            <th>Activo</th>
                            <th>Tipo</th>
                            <th>Entrada</th>
                            <th>Salida</th>
                            <th>Cantidad</th>
                            <th>Resultado</th>
                            <th>Estado</th>
                            <th>Fecha</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="tradesTableBody">
                        <!-- Las operaciones se cargar√°n aqu√≠ con JavaScript -->
                        <tr>
                            <td colspan="9" style="text-align: center; padding: 3rem; color: var(--gray);">
                                No hay operaciones registradas. ¬°Agrega tu primera operaci√≥n!
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>
    </main>
    
    <!-- FOOTER -->
    <footer class="app-footer">
        <p>Control Trading PWA - Aplicaci√≥n Web Progresiva para gesti√≥n de operaciones</p>
        <p style="margin-top: 0.5rem; font-size: 0.8rem; color: var(--gray);">
            ‚úÖ Funciona offline | ‚ö° R√°pida | üì± Instalable
        </p>
    </footer>
    
    <!-- SCRIPTS DE LA APLICACI√ìN -->
    <script>
        // DATOS DE LA APLICACI√ìN
        let trades = JSON.parse(localStorage.getItem('tradingTrades')) || [];
        let editTradeId = null;
        let deferredPrompt = null;
        
        // ELEMENTOS DEL DOM
        const tradeForm = document.getElementById('tradeForm');
        const tradesTableBody = document.getElementById('tradesTableBody');
        const installButton = document.getElementById('installButton');
        const offlineIndicator = document.getElementById('offlineIndicator');
        const messageContainer = document.getElementById('messageContainer');
        const formTitle = document.getElementById('formTitle');
        const submitBtn = document.getElementById('submitBtn');
        
        // INICIALIZAR APLICACI√ìN
        document.addEventListener('DOMContentLoaded', function() {
            initApp();
            renderTrades();
            updateStats();
            
            // Configurar fecha actual por defecto
            document.getElementById('date').value = getCurrentDateTime();
            
            // Detectar conexi√≥n
            updateOnlineStatus();
            window.addEventListener('online', updateOnlineStatus);
            window.addEventListener('offline', updateOnlineStatus);
        });
        
        // INICIALIZAR PWA
        function initApp() {
            // Registrar Service Worker para PWA
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('service-worker.js')
                    .then(registration => {
                        console.log('‚úÖ Service Worker registrado:', registration.scope);
                    })
                    .catch(error => {
                        console.log('‚ùå Error al registrar Service Worker:', error);
                    });
            }
            
            // Detectar evento de instalaci√≥n
            window.addEventListener('beforeinstallprompt', (e) => {
                e.preventDefault();
                deferredPrompt = e;
                installButton.style.display = 'block';
                
                console.log('üì± PWA lista para instalaci√≥n');
            });
            
            // Detectar si la app ya est√° instalada
            window.addEventListener('appinstalled', () => {
                console.log('üéâ ¬°Aplicaci√≥n instalada!');
                installButton.style.display = 'none';
                showMessage('¬°Aplicaci√≥n instalada con √©xito!', 'success');
            });
        }
        
        // MANEJAR INSTALACI√ìN
        installButton.addEventListener('click', async () => {
            if (!deferredPrompt) return;
            
            deferredPrompt.prompt();
            const { outcome } = await deferredPrompt.userChoice;
            
            if (outcome === 'accepted') {
                console.log('Usuario acept√≥ instalar la PWA');
            }
            
            deferredPrompt = null;
            installButton.style.display = 'none';
        });
        
        // MANEJAR FORMULARIO
        tradeForm.addEventListener('submit', function(e) {
            e.preventDefault();
            
            const tradeData = {
                id: editTradeId || Date.now(),
                asset: document.getElementById('asset').value.trim().toUpperCase(),
                type: document.getElementById('type').value,
                entryPrice: parseFloat(document.getElementById('entryPrice').value),
                exitPrice: document.getElementById('exitPrice').value ? 
                           parseFloat(document.getElementById('exitPrice').value) : null,
                quantity: parseFloat(document.getElementById('quantity').value),
                status: document.getElementById('status').value,
                date: document.getElementById('date').value,
                notes: document.getElementById('notes').value,
                timestamp: new Date().toISOString()
            };
            
            // Calcular resultado
            tradeData.result = calculateResult(tradeData);
            
            if (editTradeId) {
                // Editar operaci√≥n existente
                const index = trades.findIndex(t => t.id === editTradeId);
                if (index !== -1) {
                    trades[index] = tradeData;
                    showMessage('Operaci√≥n actualizada correctamente', 'success');
                }
            } else {
                // Nueva operaci√≥n
                trades.push(tradeData);
                showMessage('Operaci√≥n guardada correctamente', 'success');
            }
            
            // Guardar y actualizar
            saveTrades();
            renderTrades();
            updateStats();
            resetForm();
        });
        
        // CALCULAR RESULTADO
        function calculateResult(trade) {
            if (trade.status !== 'closed' || !trade.exitPrice) return 0;
            
            const priceDiff = trade.type === 'buy' ? 
                trade.exitPrice - trade.entryPrice : 
                trade.entryPrice - trade.exitPrice;
            
            return priceDiff * trade.quantity;
        }
        
        // RENDERIZAR OPERACIONES EN TABLA
        function renderTrades() {
            if (trades.length === 0) {
                tradesTableBody.innerHTML = `
                    <tr>
                        <td colspan="9" style="text-align: center; padding: 3rem; color: var(--gray);">
                            No hay operaciones registradas. ¬°Agrega tu primera operaci√≥n!
                        </td>
                    </tr>
                `;
                return;
            }
            
            // Ordenar por fecha (m√°s recientes primero)
            const sortedTrades = [...trades].sort((a, b) => 
                new Date(b.date) - new Date(a.date)
            );
            
            tradesTableBody.innerHTML = sortedTrades.map(trade => `
                <tr>
                    <td><strong>${trade.asset}</strong></td>
                    <td>
                        <span style="color: ${trade.type === 'buy' ? 'var(--success)' : 'var(--danger)'};">
                            ${trade.type === 'buy' ? 'üü¢ Compra' : 'üî¥ Venta'}
                        </span>
                    </td>
                    <td>$${trade.entryPrice.toFixed(2)}</td>
                    <td>${trade.exitPrice ? '$' + trade.exitPrice.toFixed(2) : '-'}</td>
                    <td>${trade.quantity}</td>
                    <td>
                        ${trade.result ? 
                            `<span class="${trade.result >= 0 ? 'profit' : 'loss'}">
                                ${trade.result >= 0 ? '‚Üó' : '‚Üò'} $${Math.abs(trade.result).toFixed(2)}
                            </span>` : 
                            '-'
                        }
                    </td>
                    <td>
                        <span class="status-badge status-${trade.status}">
                            ${trade.status === 'open' ? 'Abierta' : 
                              trade.result >= 0 ? 'Ganada' : 'Perdida'}
                        </span>
                    </td>
                    <td>${formatDate(trade.date)}</td>
                    <td>
                        <button class="action-btn btn-close" onclick="closeTrade(${trade.id})">
                            ${trade.status === 'open' ? 'Cerrar' : 'Reabrir'}
                        </button>
                        <button class="action-btn btn-edit" onclick="editTrade(${trade.id})">
                            Editar
                        </button>
                        <button class="action-btn btn-delete" onclick="deleteTrade(${trade.id})">
                            Eliminar
                        </button>
                    </td>
                </tr>
            `).join('');
        }
        
        // ACTUALIZAR ESTAD√çSTICAS
        function updateStats() {
            const totalTrades = trades.length;
            const closedTrades = trades.filter(t => t.status === 'closed');
            const openTrades = trades.filter(t => t.status === 'open');
            
            const totalProfit = closedTrades.reduce((sum, trade) => sum + (trade.result || 0), 0);
            const winningTrades = closedTrades.filter(t => (t.result || 0) > 0).length;
            const winRate = closedTrades.length > 0 ? 
                Math.round((winningTrades / closedTrades.length) * 100) : 0;
            
            document.getElementById('totalProfit').textContent = 
                `$${totalProfit.toFixed(2)}`;
            document.getElementById('totalTrades').textContent = totalTrades;
            document.getElementById('winRate').textContent = `${winRate}%`;
            document.getElementById('openTrades').textContent = openTrades.length;
        }
        
        // FUNCIONES DE ACCI√ìN
        window.closeTrade = function(id) {
            const tradeIndex = trades.findIndex(t => t.id === id);
            if (tradeIndex === -1) return;
            
            const trade = trades[tradeIndex];
            
            if (trade.status === 'open') {
                // Pedir precio de salida para cerrar
                const exitPrice = prompt(
                    `Ingresa el precio de salida para ${trade.asset}:`,
                    trade.entryPrice.toString()
                );
                
                if (exitPrice && !isNaN(parseFloat(exitPrice))) {
                    trade.exitPrice = parseFloat(exitPrice);
                    trade.status = 'closed';
                    trade.result = calculateResult(trade);
                    showMessage('Operaci√≥n cerrada correctamente', 'success');
                } else {
                    return;
                }
            } else {
                // Reabrir operaci√≥n
                trade.status = 'open';
                trade.exitPrice = null;
                trade.result = 0;
                showMessage('Operaci√≥n reabierta', 'success');
            }
            
            saveTrades();
            renderTrades();
            updateStats();
        };
        
        window.editTrade = function(id) {
            const trade = trades.find(t => t.id === id);
            if (!trade) return;
            
            editTradeId = id;
            
            // Llenar formulario
            document.getElementById('tradeId').value = trade.id;
            document.getElementById('asset').value = trade.asset;
            document.getElementById('type').value = trade.type;
            document.getElementById('entryPrice').value = trade.entryPrice;
            document.getElementById('exitPrice').value = trade.exitPrice || '';
            document.getElementById('quantity').value = trade.quantity;
            document.getElementById('status').value = trade.status;
            document.getElementById('date').value = trade.date;
            document.getElementById('notes').value = trade.notes || '';
            
            formTitle.textContent = '‚úèÔ∏è Editar Operaci√≥n';
            submitBtn.textContent = 'üíæ Actualizar Operaci√≥n';
            
            // Scroll al formulario
            document.querySelector('.form-container').scrollIntoView({ 
                behavior: 'smooth' 
            });
        };
        
        window.deleteTrade = function(id) {
            if (!confirm('¬øEst√°s seguro de eliminar esta operaci√≥n?')) return;
            
            trades = trades.filter(t => t.id !== id);
            saveTrades();
            renderTrades();
            updateStats();
            showMessage('Operaci√≥n eliminada', 'success');
        };
        
        // FUNCIONES AUXILIARES
        function resetForm() {
            tradeForm.reset();
            editTradeId = null;
            formTitle.textContent = 'üìù Nueva Operaci√≥n';
            submitBtn.textContent = 'üíæ Guardar Operaci√≥n';
            document.getElementById('date').value = getCurrentDateTime();
        }
        
        function saveTrades() {
            localStorage.setItem('tradingTrades', JSON.stringify(trades));
            
            // Sincronizar con Google Sheets si hay conexi√≥n
            if (navigator.onLine) {
                syncWithGoogleSheets();
            }
        }
        
        function showMessage(text, type) {
            messageContainer.innerHTML = `
                <div class="message ${type}">
                    ${type === 'success' ? '‚úÖ' : '‚ùå'} ${text}
                </div>
            `;
            
            setTimeout(() => {
                messageContainer.innerHTML = '';
            }, 3000);
        }
        
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('es-ES', {
                day: '2-digit',
                month: '2-digit',
                year: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }
        
        function getCurrentDateTime() {
            const now = new Date();
            now.setMinutes(now.getMinutes() - now.getTimezoneOffset());
            return now.toISOString().slice(0, 16);
        }
        
        function updateOnlineStatus() {
            if (navigator.onLine) {
                offlineIndicator.style.display = 'none';
                console.log('‚úÖ Conectado a internet');
            } else {
                offlineIndicator.style.display = 'block';
                console.log('‚ö†Ô∏è Sin conexi√≥n - Modo offline');
            }
        }
        
        // LIMPIAR FORMULARIO
        document.getElementById('clearBtn').addEventListener('click', resetForm);
        
        // SINCRONIZAR CON GOOGLE SHEETS
        function syncWithGoogleSheets() {
            // Esta funci√≥n se conectar√° con tu Google Script
            console.log('Sincronizando con Google Sheets...');
            
            // Aqu√≠ ir√≠a el c√≥digo para conectarse a tu Google Apps Script
            // fetch('TU_ENLACE_DE_GOOGLE_SCRIPT', {
            //     method: 'POST',
            //     body: JSON.stringify(trades)
            // })
        }
        
        // EXPORTAR DATOS
        window.exportData = function() {
            const dataStr = JSON.stringify(trades, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = `trading-backup-${new Date().toISOString().slice(0,10)}.json`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
        };
    </script>
    
    <!-- SCRIPT PARA REGISTRAR SERVICE WORKER -->
    <script>
        // Registrar Service Worker para funcionalidad offline
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('service-worker.js')
                    .then(registration => {
                        console.log('‚úÖ Service Worker registrado con √©xito:', registration.scope);
                    })
                    .catch(error => {
                        console.log('‚ùå Error al registrar Service Worker:', error);
                    });
            });
        }
    </script>
</body>
</html>
